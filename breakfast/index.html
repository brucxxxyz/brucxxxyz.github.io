<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ—©é¤æ¨è</title>

  <!-- å…¨ç«™æ ·å¼ -->
  <link rel="stylesheet" href="/common/common.css">
</head>

<body>

  <!-- é¡µé¢æ ‡é¢˜ -->
  <h1 id="t_title_breakfast"></h1>
  <div class="subtitle" id="t_subtitle_breakfast"></div>

  <!-- è¾“å…¥åŒº -->
  <div class="input-area">
    <label id="t_name_label"></label>
    <input id="nameInput" placeholder="" />

    <label id="t_date_label"></label>
    <input id="dateInput" type="date" />
  </div>

  <!-- æŒ‰é’® -->
  <button id="btnGenerate" class="primary"></button>
  <button id="btnHistory" class="secondary"></button>
  <button id="btnClear" class="danger"></button>

  <!-- ä»Šæ—¥æ—©é¤ -->
  <h2 id="t_today_breakfast"></h2>
  <div id="result"></div>

  <!-- å†å²è®°å½• -->
  <div id="history"></div>

  <!-- å…¬å…±é€»è¾‘ -->
  <script src="/common/lang.js"></script>
  <script src="/common/common.js"></script>
  <script src="/common/page-common.js"></script>

  <!-- æ—©é¤æ•°æ® -->
  <script>
    let breakfastData = {};

    async function loadBreakfastData() {
      const res = await fetch("/data/breakfast.json");
      breakfastData = await res.json();
    }
  </script>

  <!-- é¡µé¢é€»è¾‘ -->
  <script>
    async function initBreakfastPage() {
      await loadBreakfastData();   // åŠ è½½æ—©é¤æ•°æ®
      initPageCommon();            // æ³¨å…¥å¯¼èˆªæ ã€é¡¶éƒ¨æŒ‰é’®ã€ä¸»é¢˜ç­‰

      bindBreakfastTexts();        // ç»‘å®šé¡µé¢æ–‡æ¡ˆ
      setupBreakfastLogic();       // ç»‘å®šæŒ‰é’®é€»è¾‘
      loadHistory();               // åŠ è½½å†å²è®°å½•
    }

    /* ç»‘å®šé¡µé¢æ–‡æ¡ˆ */
    function bindBreakfastTexts() {
      document.getElementById("t_title_breakfast").textContent = t("title_breakfast");
      document.getElementById("t_subtitle_breakfast").textContent = t("subtitle_breakfast");
      document.getElementById("t_name_label").textContent = t("name_label");
      document.getElementById("t_date_label").textContent = t("date_label");
      document.getElementById("btnGenerate").textContent = t("btn_generate_breakfast");
      document.getElementById("btnHistory").textContent = t("btn_history");
      document.getElementById("btnClear").textContent = t("btn_clear");
      document.getElementById("t_today_breakfast").textContent = t("today_breakfast");

      document.getElementById("nameInput").placeholder = t("name_placeholder");
    }

    /* è·å–å½“å‰è¯­è¨€çš„æ—©é¤åç§° */
    function getName(item) {
      return item[currentLang] || item["zh-CN"];
    }

    /* éšæœºé€‰æ‹© */
    function rand(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    /* ç”Ÿæˆæ—©é¤ */
    function generateBreakfast() {
      const drink = rand(breakfastData.drinks);
      const staple = rand(breakfastData.staples);
      const dessert = rand(breakfastData.desserts);

      const resultHTML = `
        <div class="card">
          <p><strong>${t("option")} 1</strong></p>
          <p>ğŸ¥¤ ${getName(drink)}</p>
          <p>ğŸ ${getName(staple)}</p>
          <p>ğŸ® ${getName(dessert)}</p>
        </div>
      `;

      document.getElementById("result").innerHTML = resultHTML;

      saveHistory({
        date: document.getElementById("dateInput").value,
        drink: getName(drink),
        staple: getName(staple),
        dessert: getName(dessert)
      });
    }

    /* å†å²è®°å½• */
    function saveHistory(item) {
      const history = JSON.parse(localStorage.getItem("breakfast_history") || "[]");
      history.unshift(item);
      localStorage.setItem("breakfast_history", JSON.stringify(history));
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem("breakfast_history") || "[]");
      const container = document.getElementById("history");

      if (history.length === 0) {
        container.innerHTML = `<p>${t("history_empty")}</p>`;
        return;
      }

      container.innerHTML = history.map(h => `
        <div class="card">
          <p>${h.date}</p>
          <p>ğŸ¥¤ ${h.drink}</p>
          <p>ğŸ ${h.staple}</p>
          <p>ğŸ® ${h.dessert}</p>
        </div>
      `).join("");
    }

    function clearHistory() {
      localStorage.removeItem("breakfast_history");
      loadHistory();
    }

    /* æŒ‰é’®ç»‘å®š */
    function setupBreakfastLogic() {
      document.getElementById("btnGenerate").onclick = generateBreakfast;
      document.getElementById("btnHistory").onclick = loadHistory;
      document.getElementById("btnClear").onclick = clearHistory;
    }

    initBreakfastPage();
  </script>

</body>
</html>
