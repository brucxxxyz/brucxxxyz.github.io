<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’ª ä»Šæ—¥å¥èº«æ¨è</title>

<link rel="stylesheet" href="/common/common.css">
<script src="/common/common.js"></script>

</head>
<body>

<!-- é¡¶éƒ¨æŒ‰é’® -->
<div class="top-bar">
  <div class="icon-btn" id="langBtn">ğŸŒ</div>

  <div id="langMenu">
    <div class="lang-title">ğŸŒ Language</div>
    <div class="lang-item" data-lang="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</div>
    <div class="lang-item" data-lang="zh-HK">ğŸ‡­ğŸ‡° ç²¤è¯­ç¹é«”</div>
    <div class="lang-item" data-lang="en">ğŸ‡ºğŸ‡¸ English</div>
  </div>

  <div class="icon-btn" id="themeBtn">ğŸŒ™</div>
</div>

<!-- å¯¼èˆªæ  -->
<div class="nav">
  <a href="/">ğŸ  é¦–é¡µ</a> Â·
  <a href="/breakfast/">ğŸ³ æ—©é¤</a> Â·
  <a href="/play/">ğŸ—º æ¸¸ç©</a> Â·
  <a href="/fitness/">ğŸ’ª å¥èº«</a>
</div>

<h1 id="t_title_fitness"></h1>
<div class="subtitle" id="t_subtitle_fitness"></div>

<label id="t_name_label"></label>
<input id="name">

<label id="t_date_label"></label>
<input id="date" type="date">

<button onclick="generate()" id="t_btn_generate_fitness"></button>

<div id="options"></div>
<div id="final"></div>
<div id="historyBox"></div>

<button class="secondary" onclick="showHistory()" id="t_btn_history"></button>
<button class="danger" onclick="clearHistory()" id="t_btn_clear"></button>

<footer class="footer" id="t_footer"></footer>

<script>
/* ============================================================
   å¥èº«ä¸šåŠ¡é€»è¾‘ï¼ˆè¯­è¨€ä¸æ·±è‰²æ¨¡å¼ç”± common.js è´Ÿè´£ï¼‰
   ============================================================ */

/* 6 å¤§ç±» Ã— æ¯ç±» 6 åŠ¨ä½œ */
const categories = {
  warmup: [
    {name:"ç«™å§¿æè†æ”¶è…¹", level:1, kcal:60},
    {name:"åŸåœ°æ‘†è‡‚å¿«èµ°", level:1, kcal:70},
    {name:"è‚©éƒ¨ç»•ç¯", level:1, kcal:40},
    {name:"é¢ˆéƒ¨æ´»åŠ¨", level:1, kcal:20},
    {name:"å¼€åˆæ­¥çƒ­èº«", level:1, kcal:55},
    {name:"æ‰‹è‡‚ç”»åœˆ", level:1, kcal:45}
  ],
  legs: [
    {name:"å¾’æ‰‹æ·±è¹²", level:2, kcal:90},
    {name:"ç«™å§¿ä¾§æŠ¬è…¿", level:1, kcal:50},
    {name:"å¼“æ­¥è¹²", level:2, kcal:85},
    {name:"é å¢™é™è¹²", level:2, kcal:80},
    {name:"åè¸¢è…¿", level:1, kcal:60},
    {name:"æè¸µè®­ç»ƒ", level:1, kcal:45}
  ],
  core: [
    {name:"ç«™å§¿è½¬ä½“", level:2, kcal:80},
    {name:"ç«™å§¿æ”¶è…¹", level:1, kcal:50},
    {name:"ä¾§è…¹æ”¶ç¼©", level:2, kcal:70},
    {name:"ç«™å§¿å·è…¹", level:2, kcal:75},
    {name:"æ ¸å¿ƒç¨³å®šç«™å§¿", level:1, kcal:40},
    {name:"ç«™å§¿ä¾§å¼¯", level:1, kcal:45}
  ],
  upper: [
    {name:"ç«™å§¿æ‹³å‡»ï¼ˆæŠ€æœ¯+å‘¼å¸ï¼‰", level:2, kcal:100},
    {name:"ä¿¯èº«åˆ’èˆ¹ï¼ˆå¾’æ‰‹ï¼‰", level:2, kcal:85},
    {name:"å¢™å£ä¿¯å§æ’‘", level:2, kcal:90},
    {name:"æ‰‹è‡‚åä¼¸", level:1, kcal:50},
    {name:"è‚©æ¨ï¼ˆå¾’æ‰‹ï¼‰", level:2, kcal:80},
    {name:"æ‰‹è‡‚äº¤å‰æ‹‰ä¼¸", level:1, kcal:30}
  ],
  cardio: [
    {name:"åŸåœ°é«˜æŠ¬è…¿ï¼ˆæ…¢é€Ÿï¼‰", level:3, kcal:130},
    {name:"åŸåœ°è¸æ­¥", level:1, kcal:60},
    {name:"å¼€åˆè·³ï¼ˆä½å†²å‡»ï¼‰", level:2, kcal:110},
    {name:"å·¦å³å°è·³", level:2, kcal:95},
    {name:"è½»é‡è·‘æ­¥åŸåœ°", level:2, kcal:100},
    {name:"å¿«é€Ÿæ‘†è‡‚èµ°", level:2, kcal:90}
  ],
  boxing: [
    {name:"æ³¢æ¯”ç®€åŒ–ç‰ˆï¼ˆä¸è·³ï¼‰", level:3, kcal:120},
    {name:"è½»é‡æ‹³å‡»ç»„åˆï¼ˆç›´æ‹³+æ‘†æ‹³ï¼‰", level:2, kcal:110},
    {name:"ç›´æ‹³ç»ƒä¹ ", level:2, kcal:90},
    {name:"æ‘†æ‹³ç»ƒä¹ ", level:2, kcal:95},
    {name:"é—ªèº²æ­¥ä¼", level:2, kcal:85},
    {name:"æ‹³å‡»æ­¥ä¼ç§»åŠ¨", level:2, kcal:100}
  ]
};

function rand(arr){return arr[Math.floor(Math.random()*arr.length)];}

/* ç”Ÿæˆ 3 ç»„ Ã— æ¯ç»„ 3 åŠ¨ä½œ */
function makePlan(){
  const keys = Object.keys(categories);
  const groups = [];
  let totalKcal = 0;
  let levels = [];

  for(let g=0; g<3; g++){
    const group = [];
    for(let i=0; i<3; i++){
      const cat = rand(keys);
      const action = rand(categories[cat]);
      group.push(action);
      totalKcal += action.kcal;
      levels.push(action.level);
    }
    groups.push(group);
  }

  const maxLevel = Math.max(...levels);
  const minLevel = Math.min(...levels);
  const diff = maxLevel - minLevel;

  return { groups, totalKcal, diff };
}

/* ç”ŸæˆæŒ‰é’® */
function generate(){
  const name=document.getElementById("name").value.trim();
  if(!name){
    alert(LANG[currentLang].name_placeholder);
    return;
  }

  document.getElementById("options").innerHTML="â³ ...";
  document.getElementById("final").innerHTML="";
  document.getElementById("historyBox").innerHTML="";

  setTimeout(()=>{
    const box=document.getElementById("options");
    box.innerHTML="";

    for(let i=0;i<3;i++){
      const p=makePlan();
      const t = LANG[currentLang];

      const div=document.createElement("div");
      div.className="card";

      div.innerHTML = `
        <strong>${t.option} ${i+1}</strong>
        ${p.groups.map((group, idx)=>`
          <div class="item"><b>ç¬¬ ${idx+1} ç»„</b></div>
          ${group.map(x=>`
            <div class="item">
              ğŸ‹ï¸ ${translateExercise(x.name)}
              <span class="badge">${x.level}</span>
              <span class="badge">${x.kcal} kcal</span>
            </div>
          `).join("")}
        `).join("")}
        <div class="item">ğŸ”¥ ${p.totalKcal} kcal</div>
        <div class="item">ğŸ“Š å¼ºåº¦å·®ï¼š${p.diff}</div>
        <button onclick='choose(${JSON.stringify(p)}, "${name}")'>
          ${t.choose}
        </button>
      `;

      box.appendChild(div);
    }
  },600);
}

/* é€‰æ‹©æ–¹æ¡ˆ */
function choose(p,name){
  const h=JSON.parse(localStorage.getItem("fitnessHistory")||"[]");
  h.push({date:new Date().toLocaleDateString(),name,plan:p});
  localStorage.setItem("fitnessHistory",JSON.stringify(h));

  const t = LANG[currentLang];

  document.getElementById("options").innerHTML="";
  document.getElementById("final").innerHTML=`
    <div class="card">
      <strong>${t.today_fitness}</strong>
      ${p.groups.map((group, idx)=>`
        <div class="item"><b>ç¬¬ ${idx+1} ç»„</b></div>
        ${group.map(x=>`
          <div class="item">
            ğŸ‹ï¸ ${translateExercise(x.name)}
            <span class="badge">${x.level}</span>
            <span class="badge">${x.kcal} kcal</span>
          </div>
        `).join("")}
      `).join("")}
      <div class="item">ğŸ”¥ ${p.totalKcal} kcal</div>
      <div class="item">ğŸ“Š å¼ºåº¦å·®ï¼š${p.diff}</div>
    </div>
  `;
}

/* å†å²è®°å½• */
function showHistory(){
  const box=document.getElementById("historyBox");
  const h=JSON.parse(localStorage.getItem("fitnessHistory")||"[]");
  const t = LANG[currentLang];

  box.innerHTML="";

  if(!h.length){
    box.innerHTML=`<div class="card">${t.history_empty}</div>`;
    return;
  }

  h.forEach(x=>{
    box.innerHTML+=`
      <div class="card">
        <strong>${x.date} Â· ${x.name}</strong>
        ${x.plan.groups.map((group, idx)=>`
          <div class="item"><b>ç¬¬ ${idx+1} ç»„</b></div>
          ${group.map(p=>`
            <div class="item">
              ğŸ‹ï¸ ${translateExercise(p.name)}
              <span class="badge">${p.level}</span>
              <span class="badge">${p.kcal} kcal</span>
            </div>
          `).join("")}
        `).join("")}
        <div class="item">ğŸ”¥ ${x.plan.totalKcal} kcal</div>
        <div class="item">ğŸ“Š å¼ºåº¦å·®ï¼š${x.plan.diff}</div>
      </div>
    `;
  });
}

/* æ¸…é™¤å†å² */
function clearHistory(){
  if(confirm("ç¡®å®šæ¸…é™¤æ‰€æœ‰å¥èº«å†å²ï¼Ÿ")){
    localStorage.removeItem("fitnessHistory");
    document.getElementById("historyBox").innerHTML="";
  }
}

/* åˆå§‹åŒ–æ—¥æœŸ */
document.getElementById("date").value=new Date().toISOString().slice(0,10);
</script>

</body>
</html>
